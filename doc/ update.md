

1. **–ü–∞—Ç—á‚Äë—Å–ø–µ–∫–∞** (–∫–∞–∫ —É INSIGHTS/PLANNER, –Ω–æ –ø—Ä–æ GPT‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤–æ –≤—Å–µ –º–æ–¥—É–ª–∏).
2. **–ü—Ä–æ–º–ø—Ç‚Äë–ø–∞–∫–µ—Ç** (system/dev/templates) –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–≤—ã–∑–æ–≤–æ–≤ –º–æ–¥–µ–ª–∏.

–°–∫–æ–ø–∏—Ä—É–π –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `.md`/`.txt` —Ñ–∞–π–ª—ã —É —Å–µ–±—è –≤ –ø—Ä–æ–µ–∫—Ç–µ.

---

## üìù –ß–ê–°–¢–¨ 1. LEORA ‚Äî GPT Analyzer Integration v1.0 ‚Äî **–ü–ê–¢–ß –ö –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

````markdown
# ü§ñ LEORA ‚Äî GPT Analyzer Integration v1.0 ‚Äî –ü–ê–¢–ß –ö –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

–≠—Ç–æ—Ç –ø–∞—Ç—á –¥–æ–ø–æ–ª–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏ (PLANNER, INSIGHTS, FINANCE, HOME, MORE),
–≤—Å—Ç—Ä–∞–∏–≤–∞—è GPT –∫–∞–∫ **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∏ —Å–æ–≤–µ—Ç—É—é—â–∏–π —Å–ª–æ–π** (Insight/Advisor Engine).
–ù–µ –ª–æ–º–∞–µ–º —Ç–µ–∫—É—â–∏–π UX/–Ω–∞–≤–∏–≥–∞—Ü–∏—é ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º *—Å–≤—è–∑–Ω–æ—Å—Ç—å, –¥–µ–π—Å—Ç–≤–∏—è –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å*.

---

## 0. –¶–µ–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è)
- –î–µ–π—Å—Ç–≤–∏–µ, –∞ –Ω–µ –ª–µ–∫—Ü–∏—è: –∫–∞–∂–¥–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ = **1 –ø–æ–Ω—è—Ç–Ω–∞—è CTA**.
- –°–≤—è–∑–Ω–æ—Å—Ç—å: **—Ü–µ–ª–∏ ‚Üî –∑–∞–¥–∞—á–∏ ‚Üî –ø—Ä–∏–≤—ã—á–∫–∏ ‚Üî —Ñ–∏–Ω–∞–Ω—Å—ã ‚Üî –∏–Ω—Å–∞–π—Ç—ã**.
- –û—Ñ—Ñ–ª–∞–π–Ω‚Äë–ø–µ—Ä–≤—ã–π, –ø—Ä–∏–≤–∞—Ç–Ω—ã–π; GPT –ø–æ–ª—É—á–∞–µ—Ç **–∞–≥—Ä–µ–≥–∞—Ç—ã**, –Ω–µ ¬´—Å—ã—Ä—ã–µ¬ª PII.
- 5 —è–∑—ã–∫–æ–≤ (EN/RU/UZ/TR/AR —Å RTL), —Å—Ç—Ä–æ–≥–∏–π i18n –ø–æ –∫–ª—é—á–∞–º.
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞: p95 UI < 150‚ÄØ–º—Å (–ø–æ—Å–ª–µ –∫–µ—à–∞), ¬´CTA acted %¬ª —Ä–∞—Å—Ç—ë—Ç —Å–ø—Ä–∏–Ω—Ç‚Äë–∫‚Äë—Å–ø—Ä–∏–Ω—Ç—É.

---

## 1. –ì–¥–µ –≤—ã–∑—ã–≤–∞–µ–º GPT (–ø–æ—Ç–æ–∫–∏)
- **Daily Overview (—É—Ç—Ä–æ/–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥):** –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å–∞–π—Ç –¥–Ω—è + 2‚Äì4 –¥–æ–ø., 1‚Äì3 –≤–æ–ø—Ä–æ—Å–∞.
- **Event triggers:** –∫—Ä—É–ø–Ω–∞—è —Ç—Ä–∞—Ç–∞/–∞–Ω–æ–º–∞–ª–∏—è –±—é–¥–∂–µ—Ç–∞, –ø—Ä–æ—Å—Ä–æ—á–∫–∞ IOU, –ø—Ä–æ–≤–∞–ª/—É—Å–ø–µ—Ö –ø—Ä–∏–≤—ã—á–∫–∏, –æ–∫–æ–Ω—á–∞–Ω–∏–µ —Ñ–æ–∫—É—Å‚Äë—Å–µ—Å—Å–∏–∏, –∑–∞–≤–∞–ª –∑–∞–¥–∞—á.
- **Weekly/Monthly review:** –æ–±–æ–±—â–∞—é—â–∏–µ –∏–Ω—Å–∞–π—Ç—ã, –º–∏–Ω–∏‚Äë–ø–ª–∞–Ω –æ—Ç ¬´—Å–æ–≤–µ—Ç–Ω–∏–∫–∞¬ª.

> –í—Å–µ —Ç—Ä–∏ –ø–æ—Ç–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç I/O, —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ ¬´user‚Äëprompt template¬ª –∏ –æ–±—ä—ë–º–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–Ω—Ç–∞–π–º–∞
- **Client Aggregator (App):** —Å–æ–±–∏—Ä–∞–µ—Ç *—Å–∂–∞—Ç—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã* –∏–∑ PLANNER/FINANCE/Activity/History.
- **aiAdapter (App/Server):** 
  - –º–∞—Å–∫–∏—Ä—É–µ—Ç PII, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç input,
  - –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JSON –æ—Ç–≤–µ—Ç –ø–æ —Å—Ö–µ–º–µ,
  - –∫–µ—à–∏—Ä—É–µ—Ç –¥–Ω–µ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –¥–µ–ª–∞–µ—Ç backoff/retry.
- **Fallback Engine (–ª–æ–∫–∞–ª—å–Ω–æ):** –µ—Å–ª–∏ GPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø—Ä–æ—Å—Ç—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ ‚Üí 1‚Äì2 –ø–æ–¥—Å–∫–∞–∑–∫–∏ –±–µ–∑ ¬´—Å–æ–≤–µ—Ç–Ω–∏–∫–æ–≤¬ª.

---

## 3. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö (–º–∏–Ω–∏–º—É–º)

### 3.1. –í—Ö–æ–¥ –≤ GPT (InputSnapshot, –∞–≥—Ä–µ–≥–∞—Ç—ã)
```json
{
  "meta": { "locale": "ru-RU", "rtl": false, "tz": "Asia/Tashkent", "today": "2025-11-15", "app_version": "x.y.z" },
  "flags": { "ai_mode": "moderate", "privacy_mode": true, "ab_bucket": "insight_v2" },

  "planner": {
    "tasks": [{ "id":"t1","title":"Call client","date":"2025-11-15","time":"15:00","status":"planned","priority":"high","energy":2,"goalId":"g1" }],
    "habits": [{ "id":"h1","title":"10k steps","streak":12,"linkedGoalIds":["g2"] }],
    "goals":  [{ "id":"g1","title":"Launch feature","type":"professional","progress":0.42 }]
  },

  "finance": {
    "budgets": [{ "id":"b1","cat":"Dining","limit":1000000,"spent_mtd":200000,"currency":"UZS" }],
    "txns_sample": [{ "dt":"2025-11-13","amount":-120000,"currency":"UZS","cat":"Dining" }],
    "iou": [{ "id":"i1","name_alias":"Aziz","amount":500000,"currency":"UZS","due":"2025-11-28","status":"active" }]
  },

  "activity": { "steps_today": 3200, "health_linked": true },

  "history": {
    "insights_recent": [{ "id":"ins1","type":"finance","acted":true }],
    "questions_recent": [{ "id":"q1","answered":true }]
  }
}
````

### 3.2. –í—ã—Ö–æ–¥ –∏–∑ GPT (OutputPayload, **—Ç–æ–ª—å–∫–æ i18n‚Äë–∫–ª—é—á–∏**)

```json
{
  "indexes": {
    "personalPerformance": 7.6, "financialHealth": 6.8, "productivity": 7.9,
    "workLifeBalance": 6.1, "discipline": 6.9, "achievingGoals": 7.2
  },
  "main_insight": {
    "type": "finance",
    "title_key": "insights.main.dinners_over.title",
    "description_key": "insights.main.dinners_over.desc",
    "severity": "warning",
    "cta": {
      "type": "create_rule",
      "label_key": "insights.main.dinners_over.cta",
      "payload": { "targetView":"finance_budgets", "suggestedValue":"80000 UZS/day" }
    }
  },
  "secondary_insights": [
    {
      "type":"habit",
      "title_key":"insights.habit.steps_low.title",
      "description_key":"insights.habit.steps_low.desc",
      "severity":"info",
      "cta":{ "type":"create_habit","label_key":"insights.habit.steps_low.cta","payload":{"habitId":null,"suggestedValue":10000} }
    }
  ],
  "questions": [
    {
      "id":"q_steps_barrier",
      "text_key":"questions.steps_barrier.text",
      "choices":[
        {"id":"no_time","label_key":"questions.steps_barrier.no_time"},
        {"id":"forget","label_key":"questions.steps_barrier.forget"},
        {"id":"no_value","label_key":"questions.steps_barrier.no_value"}
      ],
      "allowFreeText": true,
      "contextKey": "activity_barrier"
    }
  ],
  "advice":[{ "advisor":"stoic", "plan":[{"key":"advice.stoic.step1"},{"key":"advice.stoic.step2"}] }]
}
```

**CTA types (–∂—ë—Å—Ç–∫–æ):**
`open_view | create/update_budget | create/update_rule | create/update_task | reschedule_tasks | create/update_habit | adjust_goal | adjust_iou`

---

## 4. –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—è–º

### 4.1 INSIGHTS

* –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç `main_insight` –∫—Ä—É–ø–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π (1 CTA), –¥–∞–ª–µ–µ `secondary_insights`.
* –ë–ª–æ–∫ ¬´–í–æ–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è¬ª (1‚Äì3), –æ—Ç–≤–µ—Ç—ã ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç.
* –≠–∫—Ä–∞–Ω ¬´–ò—Å—Ç–æ—Ä–∏—è –∏–Ω—Å–∞–π—Ç–æ–≤¬ª: acted/dismissed/read + —Ñ–∏–ª—å—Ç—Ä—ã.

### 4.2 PLANNER

* –ü–æ—Å–ª–µ Focus‚Äë—Å–µ—Å—Å–∏–∏ ‚Üí event trigger –≤ GPT ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã–π –∏–Ω—Å–∞–π—Ç: ¬´–∑–∞–∫—Ä—ã—Ç—å/–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏¬ª.
* Add Task/Habit/Goal —Ñ–æ—Ä–º—ã: AI‚Äë–±–ª–æ–∫ ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏¬ª.
* –°–≤—è–∑–∏ `task.goalId`, `habit.linkedGoalIds[]` ‚Äî –≤—ã–≤–æ–¥–∏–º –±–µ–π–¥–∂–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö.

### 4.3 FINANCE

* –ê–Ω–æ–º–∞–ª–∏–∏/–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ ‚Üí –∏–Ω—Å–∞–π—Ç—ã —Å CTA: —Å–æ–∑–¥–∞—Ç—å –ª–∏–º–∏—Ç/–ø—Ä–∞–≤–∏–ª–æ, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ IOU.
* –ë—é–¥–∂–µ—Ç—ã —Å rollover, IOU —Å –º—è–≥–∫–æ–π —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–µ–π ‚Äî –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ –≤ CTA.

### 4.4 HOME

* –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —Ä–µ–∑—é–º–µ (2‚Äì3 —Å—Ç—Ä–æ–∫–∏) + quick‚Äëactions (log expense / add task / mark habit / start focus).

---

## 5. –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å/—Å—Ç–æ–∏–º–æ—Å—Ç—å/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

* **PII** –º–∞—Å–∫–∏—Ä—É–µ–º (–∏–º–µ–Ω–∞ ‚Üí –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã), –ø–µ—Ä–µ–¥–∞—ë–º –∞–≥—Ä–µ–≥–∞—Ç—ã.
* **Rate‚Äëlimits:** –Ω–µ –±–æ–ª–µ–µ X –≤—ã–∑–æ–≤–æ–≤/—Å—É—Ç–∫–∏/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (daily + 2 —Å–æ–±—ã—Ç–∏—è).
* **–ö–µ—à:** –¥–Ω–µ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç; –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º.
* **Fallback:** —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ (–±–µ–∑ GPT) –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
* **–õ–æ–≥–∏:** –±–µ–∑ PII, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤ MORE; —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî –º–∏–Ω–∏–º—É–º –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.

---

## 6. i18n (EN/RU/UZ/TR/AR)

* –ú–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏**, —Ç–µ–∫—Å—Ç—ã ‚Äî –∏–∑ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.
* RTL (AR) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ; —á–∏—Å–ª–æ–≤—ã–µ/–≤–∞–ª—é—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ (–≤ —Ç.—á. UZS).

---

## 7. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–º–∏–Ω–∏–º—É–º)

* `insight_shown`, `insight_cta_clicked`, `question_answered`
* `planner_task_created|completed|moved`, `planner_focus_started|finished`
* `finance_tx_added`, `budget_rule_created`, `iou_rescheduled`
* –í—Å–µ —Å–æ–±—ã—Ç–∏—è: `{ locale, tz, app_version, ab_flag }`, –±–µ–∑ PII.

---

## 8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* p95: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ UI –±–ª–æ–∫–∞ –∏–Ω—Å–∞–π—Ç–æ–≤ ‚â§100‚ÄØ–º—Å (–ø–æ—Å–ª–µ –∫–µ—à–∞).
* –û–¥–∏–Ω –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ (–±–µ–∑ –∫–µ—à–∞) ‚Äî –±—é–¥–∂–µ—Ç ‚â§ 600‚Äì800‚ÄØ–º—Å –Ω–∞ –æ—Ç–≤–µ—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏/—Å–µ—Ç–∏).
* –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤, –º–µ–º–æ‚Äë—Å–µ–ª–µ–∫—Ç–æ—Ä—ã, –±–∞—Ç—á‚Äë–∞–ø–¥–µ–π—Ç—ã.

---

## 9. Definition of Done (ship‚Äë–±–ª–æ–∫–µ—Ä—ã)

* [ ] –ö–æ–Ω—Ç—Ä–∞–∫—Ç I/O –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ JSON‚Äë—Å—Ö–µ–º–µ, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —Ä–∞–Ω—Ç–∞–π–º–æ–º.
* [ ] –í—Å–µ CTA –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –¥–µ–π—Å—Ç–≤–∏—é/–Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
* [ ] –§–æ–ª–ª–±–µ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ GPT —Ä–∞–±–æ—Ç–∞–µ—Ç, UX –Ω–µ —Å—ã–ø–µ—Ç—Å—è.
* [ ] –ù–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ i18n (EN/RU/UZ/TR/AR); RTL –æ–∫.
* [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ (–º–æ–∫–∏/—Å—Ç–∞–±—ã).
* [ ] p95 –º–µ—Ç—Ä–∏–∫–∏ –≤ –±—é–¥–∂–µ—Ç–µ; —Ç–µ—Å—Ç—ã (unit/E2E) –∑–µ–ª—ë–Ω—ã–µ.

````

---

## ‚öôÔ∏è –ß–ê–°–¢–¨ 2. **–ü—Ä–æ–º–ø—Ç‚Äë–ø–∞–∫–µ—Ç** –¥–ª—è GPT Analyzer (–ø—Ä–æ–¥)

–°–æ—Ö—Ä–∞–Ω–∏ –∫–∞–∫ `prompts/gpt_analyzer_bundle.md`.

```markdown
# üéõÔ∏è LEORA ‚Äî GPT Analyzer ¬∑ Production Prompt Bundle

> –ú–æ–¥–µ–ª—å –≤—ã–¥–∞—ë—Ç **—Ç–æ–ª—å–∫–æ JSON –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É** (—Å–º. —Å—Ö–µ–º—É).
> –ù–∏–∫–∞–∫–∏—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π/–æ–±—ä—è—Å–Ω–µ–Ω–∏–π –≤ –æ—Ç–≤–µ—Ç–µ ‚Äî —Ä–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ i18n‚Äë–∫–ª—é—á–∞–º (EN/RU/UZ/TR/AR).

---

## 1) SYSTEM PROMPT (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤)

You are LEORA‚Äôs Insight & Advisor Engine.
Your job: turn summarized user data into calm, human, **actionable** recommendations.
**Every recommendation has exactly ONE clear CTA** with a minimal payload.
**Return ONLY valid JSON matching the contract.**  
Use **i18n keys** for all user-facing strings (titles, descriptions, labels) for EN/RU/UZ/TR/AR; the app renders texts.
If data is insufficient or conflicting, generate up to **3 QUESTIONS** (each with short choices + allowFreeText if helpful).
**Never output chain-of-thought or extra prose.** No PII, no bank logins.

Constraints:
- Insights: 1 `main_insight` + up to 4 `secondary_insights`.
- Severity: one of `info | warning | opportunity`.
- CTA types (enum): `open_view | create/update_budget | create/update_rule | create/update_task | reschedule_tasks | create/update_habit | adjust_goal | adjust_iou`.
- Use the user‚Äôs currency symbol/ISO provided in input.
- Avoid repeating same insight on consecutive days unless data changed.

---

## 2) DEVELOPER PROMPT (–ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç—ã)

Formatting:
- Output MUST be a single JSON object with fields: `indexes`, `main_insight`, `secondary_insights`, `questions`, `advice`.
- All string fields shown to users must be **i18n keys** (e.g., `insights.main.dinners_over.title`).
- For CTAs include the minimal actionable payload: `{ targetView?, entityId?, suggestedValue?, suggestedDate? }`.

Policies:
- Respect minimal context: prioritize high-impact, low-friction actions.
- Prefer habit/goal/task alignment and budget rules to lecturing.
- Don‚Äôt invent screens/actions: use only allowed `targetView` and `cta` enums.
- Keep numbers consistent and realistic; if uncertain, ask a QUESTION rather than guessing.

---

## 3) USER PROMPT TEMPLATES

### 3.1. DAILY OVERVIEW (—É—Ç—Ä–æ/–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –¥–Ω—è)

User locale: {{locale}}, RTL: {{rtl}}, TZ: {{tz}}, Today: {{today}}
Context flags: {{flags_json}}

Data snapshots (summaries):
- Planner: {{planner_summary_json}}
- Finance: {{finance_summary_json}}
- Activity: {{activity_summary_json}}
- History: {{history_summary_json}}

Task:
1) Compute 6 indexes [0..10].
2) Produce ONE `main_insight` (with single actionable CTA).
3) Up to 4 `secondary_insights` (each with CTA).
4) Up to 3 `questions` if data is missing/conflicting.
5) Optional `advice` (1 advisor, up to 3 steps).

Return strictly valid JSON per the contract. No prose.

---

### 3.2. EVENT TRIGGER (—Å–æ–±—ã—Ç–∏–π–Ω—ã–π –≤—ã–∑–æ–≤)

Trigger: {{event_type}}  
Example values: `finance_tx_added | budget_anomaly | iou_overdue | habit_broken | focus_finished | tasks_overdue`

User locale: {{locale}}, RTL: {{rtl}}, TZ: {{tz}}, Today: {{today}}
Data deltas: {{delta_json}}
Small context: {{small_context_json}}

Task:
- Re-evaluate only affected areas.
- If a new **high-impact** insight emerged, include it; otherwise, return empty `secondary_insights`.
- No more than 1 QUESTION unless essential.
- Keep output JSON minimal and valid.

---

### 3.3. WEEKLY/MONTHLY REVIEW

User locale: {{locale}}, RTL: {{rtl}}, TZ: {{tz}}
Period: {{period_range}}  // e.g., "2025-11-10..2025-11-16"

Summaries:
- Planner weekly stats: {{planner_week_json}}
- Finance weekly stats: {{finance_week_json}}
- Habits weekly stats: {{habits_week_json}}

Task:
- Compute indexes with weekly context.
- Provide 1 `main_insight` and up to 3 `secondary_insights`.
- Provide advisor `plan` (max 3 steps) using i18n keys.
- Return strict JSON.

---

## 4) JSON SCHEMA (–∫–æ–Ω—Ç—É—Ä—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)

- Indexes: numbers (0..10).
- main_insight/secondary_insights:
  - `type`: enum
  - `title_key`, `description_key`: string
  - `severity`: enum
  - `cta`: { `type`: enum, `label_key`: string, `payload`?: object }
- questions:
  - `id`: string, `text_key`: string, `choices`?: [{ id, label_key }], `allowFreeText`: boolean, `contextKey`: string.
- advice: [{ advisor: string, plan: [{ key: string }] }]

(–†–µ–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–¥–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —Ä–∞–Ω—Ç–∞–π–º–æ–º.)

---

## 5) I18N –ü–†–ò–ú–ï–†–´ (5 —è–∑—ã–∫–æ–≤, –∫–ª—é—á–∏)

```json
{
  "insights.main.dinners_over.title": {
    "en": "Weekday dinners exceed your baseline",
    "ru": "–£–∂–∏–Ω—ã –≤ –±—É–¥–Ω–∏ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ —Ä–∞–º–∫–∏",
    "uz": "Ish kunlari kechki ovqatlar me‚Äôyoridan oshgan",
    "tr": "Hafta i√ßi ak≈üam yemekleri sƒ±nƒ±rƒ± a≈üƒ±yor",
    "ar": "ÿπÿ¥ÿßÿ° ÿ£ŸäÿßŸÖ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ Ÿäÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÖÿπÿ™ÿßÿØ"
  },
  "insights.main.dinners_over.desc": {
    "en": "Dining-out is +35% vs. norm. Let‚Äôs calmly cap it.",
    "ru": "–†–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –≤—ã—à–µ –Ω–æ—Ä–º—ã –Ω–∞ +35%. –û–≥—Ä–∞–Ω–∏—á–∏–º –∏—Ö —Å–ø–æ–∫–æ–π–Ω–æ.",
    "uz": "Tashqarida ovqatlanish odatdagidan +35% ko‚Äòp. Buni sokin cheklaymiz.",
    "tr": "Dƒ±≈üarƒ±da yemek harcamasƒ± normunun %35 √ºzerinde. Sakince sƒ±nƒ±rlandƒ±ralƒ±m.",
    "ar": "ÿ•ŸÜŸÅÿßŸÇ ÿßŸÑŸÖÿ∑ÿßÿπŸÖ ÿ£ÿπŸÑŸâ ÿ®ŸÜÿ≥ÿ®ÿ© %35 ŸÖŸÜ ÿßŸÑŸÖÿπÿ™ÿßÿØ. ŸÑŸêŸÜÿ≠ÿØÿØ ÿ≥ŸÇŸÅŸãÿß ÿ®ŸáÿØŸàÿ°."
  },
  "insights.main.dinners_over.cta": {
    "en": "Create dinner limit",
    "ru": "–°–æ–∑–¥–∞—Ç—å –ª–∏–º–∏—Ç –Ω–∞ —É–∂–∏–Ω—ã",
    "uz": "Kechki ovqat uchun limit qo‚Äòyish",
    "tr": "Ak≈üam yemeƒüi limiti olu≈ütur",
    "ar": "ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿØ ŸÑŸÑÿπÿ¥ÿßÿ°"
  },
  "questions.steps_barrier.text": {
    "en": "What usually prevents you from walking?",
    "ru": "–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –º–µ—à–∞–µ—Ç –≤–∞–º —Ö–æ–¥–∏—Ç—å?",
    "uz": "Yurishga odatda nima xalal beradi?",
    "tr": "Y√ºr√ºmeyi genelde ne engelliyor?",
    "ar": "ŸÖÿß ÿßŸÑÿ∞Ÿä ŸäŸÖŸÜÿπŸÉ ÿπÿßÿØÿ©Ÿã ŸÖŸÜ ÿßŸÑŸÖÿ¥Ÿäÿü"
  }
}
````

---

## 6) CHECKLIST –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥‚Äë–≤–∫–ª—é—á–µ–Ω–∏–µ–º

* Contract JSON –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è, –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã.
* –§–æ–ª–ª–±–µ–∫ (—ç–≤—Ä–∏—Å—Ç–∏–∫–∏) –¥–∞—ë—Ç 1‚Äì2 –ø–æ–¥—Å–∫–∞–∑–∫–∏, –µ—Å–ª–∏ GPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
* –ö–µ—à –∏ rate‚Äëlimits –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (daily + 2 event triggers).
* –í—Å–µ –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –≤ i18n –Ω–∞ **EN/RU/UZ/TR/AR**, RTL –ø—Ä–æ–≤–µ—Ä–µ–Ω.
* –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: `insight_shown`, `insight_cta_clicked`, `question_answered` –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.

