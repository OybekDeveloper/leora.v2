# Offline/Online матрица и критерии приёмки

## 1. Матрица возможностей

| Модуль/операция                                | Offline | Online |
|------------------------------------------------|---------|--------|
| Просмотр счетов/транзакций/бюджетов            | ✅       | ✅      |
| Создание/редактирование счетов и транзакций    | ✅ (Realm) | ✅ (с последующей синхронизацией) |
| Обновление курсов валют                         | ❌       | ✅ (через FxService провайдеры) |
| Голос/AI инсайты                                | ❌       | ✅      |
| Настройки региона/валюты                        | ✅       | ✅ (с обновлением курсов при наличии сети) |

## 2. Критерии приёмки

- **Finance/Planner CRUD**: операции работают офлайн, после повторного входа данные совпадают с Realm.
- **FX**: ручной override фиксируется и виден после перезапуска; синхронизация провайдера обновляет курсы в Finance и MORE.
- **Home Dashboard**: отображает данные после перезапуска без сети.
- **Feature Flags**: GPT/Voice функции отключаются единым флагом, приложение продолжает работать.

## 3. Feature Flags

| Flag                   | Назначение                               | Значение по умолчанию |
|------------------------|------------------------------------------|-----------------------|
| `feature.aiGateway`    | Включение AI Gateway и инсайтов          | `false`               |
| `feature.voiceAssistant` | Голосовой ассистент                     | `false`               |
| `feature.fxProviders`  | Синхронизация курсов через провайдеры    | `true`                |

## 4. Тест/миграции

1. **Realm migration 4.x**: откатывается через удаление схемы/данных, содержит idempotency keys.  
2. **FX Service**: e2e-тесты:
   - ручной override → новый курс отображается в MORE;
   - синхронизация провайдера → курсы обновляются, транзакции пересчитываются.  
3. **Offline**: режим "авиарежим" + перезапуск → проверка, что данные из Realm доступны.  
4. **Feature flags**: переключение в настройках (`app/profile`) → функции GPT/Voice скрываются.
